(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-78f70fc9"],{1540:function(e,t,a){"use strict";a.d(t,"b",(function(){return l})),a.d(t,"a",(function(){return o})),a.d(t,"c",(function(){return n})),a.d(t,"d",(function(){return s})),a.d(t,"h",(function(){return i})),a.d(t,"f",(function(){return u})),a.d(t,"e",(function(){return c})),a.d(t,"g",(function(){return m}));var r=a("b775");function l(e){return Object(r["a"])({url:"/forum/articleList",method:"get",params:e})}function o(e){return Object(r["a"])({url:"/forum/detail/"+e,method:"get"})}function n(e,t){return Object(r["a"])({url:"/forum/userLike",method:"get",params:{eid:e,uid:t}})}function s(e,t,a){return Object(r["a"])({url:"/forum/likeArticle",method:"get",params:{aid:e,uid:t,authorId:a}})}function i(e){return Object(r["a"])({url:"/forum/comment",method:"post",data:e})}function u(e,t){return Object(r["a"])({url:"/forum/comments/"+e,method:"get",params:t})}function c(e){return Object(r["a"])({url:"/forum/likeComment",method:"get",params:e})}function m(e){return Object(r["a"])({url:"/forum/article",method:"post",data:e})}},1925:function(e,t,a){"use strict";a.d(t,"b",(function(){return l})),a.d(t,"a",(function(){return o}));var r=a("b775");function l(e,t){return Object(r["a"])({url:"/search/"+e,method:"get",params:t})}function o(e){return Object(r["a"])({url:"/search/name/"+e,method:"get"})}},2934:function(e,t,a){"use strict";a.d(t,"b",(function(){return l})),a.d(t,"a",(function(){return o}));var r=a("b775");function l(){return Object(r["a"])({url:"/common/getId",method:"get"})}function o(){return Object(r["a"])({url:"/common/getType",method:"get"})}},"3a4e":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"top-container"},[t("div",{staticClass:"return",on:{click:e.returnLast}},[t("span",{staticClass:"el-icon-arrow-left"},[e._v("返回")])]),t("div",{staticClass:"publish"},[t("button",{staticClass:"el-button el-button--primary el-button--mini",staticStyle:{"margin-left":"10px"},attrs:{"data-v-70c12ddb":"",type:"button"},on:{click:e.submitForm}},[t("span",[e._v(" 发布 ")])])])]),t("div",{staticClass:"createPost-main-container"},[t("el-form",{ref:"postForm",staticClass:"form-container",attrs:{model:e.postForm,rules:e.rules}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{staticStyle:{"margin-bottom":"20px"},attrs:{prop:"title"}},[t("MDinput",{attrs:{maxlength:100,name:"name",required:""},model:{value:e.postForm.title,callback:function(t){e.$set(e.postForm,"title",t)},expression:"postForm.title"}},[e._v(" 标题 ")])],1)],1)],1),t("el-form-item",{staticStyle:{"margin-bottom":"20px"},attrs:{"label-width":"90px",id:"mid",label:"相关电影:",prop:"mid"}},[t("el-autocomplete",{staticClass:"related-movies",attrs:{"fetch-suggestions":e.querySearchAsync,placeholder:"请输入选择相关电影"},on:{select:e.handleSelect},model:{value:e.selectMovie.value,callback:function(t){e.$set(e.selectMovie,"value",t)},expression:"selectMovie.value"}})],1),t("el-form-item",{staticStyle:{"margin-bottom":"10px"},attrs:{"label-width":"90px",id:"summary",prop:"summary"}},[t("label",{staticClass:"label-text",attrs:{slot:"label"},slot:"label"},[e._v("摘       要:")]),t("el-input",{staticClass:"article-textarea",attrs:{rows:1,type:"textarea",autosize:"",placeholder:"请输入摘要",maxlength:"200"},model:{value:e.postForm.summary,callback:function(t){e.$set(e.postForm,"summary",t)},expression:"postForm.summary"}}),t("span",{directives:[{name:"show",rawName:"v-show",value:e.contentShortLength,expression:"contentShortLength"}],staticClass:"word-counter"},[e._v(e._s(e.contentShortLength)+"/200")])],1),t("el-form-item",{staticStyle:{"margin-bottom":"30px"},attrs:{prop:"content"}},[t("editorHtml",{ref:"editor",attrs:{modelValue:e.postForm.content,height:400},on:{change:e.getHtml}})],1),t("el-form-item",{staticStyle:{"margin-bottom":"30px"},attrs:{prop:"cover"}},[t("el-upload",{staticClass:"image-uploader",attrs:{accept:".png,.jpg",multiple:!1,"show-file-list":!1,headers:e.header,"on-success":e.handleImageSuccess,drag:"",action:e.uploadAction}},[t("i",{staticClass:"el-icon-upload"}),t("div",{staticClass:"el-upload__text"},[e._v(" 将文件拖到此处上传封面，或"),t("em",[e._v("点击上传")])])]),t("div",{staticClass:"image-preview"},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.postForm.cover.length>1,expression:"postForm.cover.length > 1"}],staticClass:"image-preview-wrapper"},[t("img",{attrs:{src:e.postForm.cover}}),t("div",{staticClass:"image-preview-action"},[t("i",{staticClass:"el-icon-delete",on:{click:e.rmImage}})])])])],1)],1)],1)])},l=[],o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"material-input__component",class:e.computedClasses},[t("div",{class:{iconClass:e.icon}},[e.icon?t("i",{staticClass:"el-input__icon material-input__icon",class:["el-icon-"+e.icon]}):e._e(),"email"===e.type?t("input",{directives:[{name:"model",rawName:"v-model",value:e.currentValue,expression:"currentValue"}],staticClass:"material-input",attrs:{name:e.name,placeholder:e.fillPlaceHolder,readonly:e.readonly,disabled:e.disabled,autocomplete:e.autoComplete,required:e.required,type:"email"},domProps:{value:e.currentValue},on:{focus:e.handleMdFocus,blur:e.handleMdBlur,input:[function(t){t.target.composing||(e.currentValue=t.target.value)},e.handleModelInput]}}):e._e(),"url"===e.type?t("input",{directives:[{name:"model",rawName:"v-model",value:e.currentValue,expression:"currentValue"}],staticClass:"material-input",attrs:{name:e.name,placeholder:e.fillPlaceHolder,readonly:e.readonly,disabled:e.disabled,autocomplete:e.autoComplete,required:e.required,type:"url"},domProps:{value:e.currentValue},on:{focus:e.handleMdFocus,blur:e.handleMdBlur,input:[function(t){t.target.composing||(e.currentValue=t.target.value)},e.handleModelInput]}}):e._e(),"number"===e.type?t("input",{directives:[{name:"model",rawName:"v-model",value:e.currentValue,expression:"currentValue"}],staticClass:"material-input",attrs:{name:e.name,placeholder:e.fillPlaceHolder,step:e.step,readonly:e.readonly,disabled:e.disabled,autocomplete:e.autoComplete,max:e.max,min:e.min,minlength:e.minlength,maxlength:e.maxlength,required:e.required,type:"number"},domProps:{value:e.currentValue},on:{focus:e.handleMdFocus,blur:e.handleMdBlur,input:[function(t){t.target.composing||(e.currentValue=t.target.value)},e.handleModelInput]}}):e._e(),"password"===e.type?t("input",{directives:[{name:"model",rawName:"v-model",value:e.currentValue,expression:"currentValue"}],staticClass:"material-input",attrs:{name:e.name,placeholder:e.fillPlaceHolder,readonly:e.readonly,disabled:e.disabled,autocomplete:e.autoComplete,max:e.max,min:e.min,required:e.required,type:"password"},domProps:{value:e.currentValue},on:{focus:e.handleMdFocus,blur:e.handleMdBlur,input:[function(t){t.target.composing||(e.currentValue=t.target.value)},e.handleModelInput]}}):e._e(),"tel"===e.type?t("input",{directives:[{name:"model",rawName:"v-model",value:e.currentValue,expression:"currentValue"}],staticClass:"material-input",attrs:{name:e.name,placeholder:e.fillPlaceHolder,readonly:e.readonly,disabled:e.disabled,autocomplete:e.autoComplete,required:e.required,type:"tel"},domProps:{value:e.currentValue},on:{focus:e.handleMdFocus,blur:e.handleMdBlur,input:[function(t){t.target.composing||(e.currentValue=t.target.value)},e.handleModelInput]}}):e._e(),"text"===e.type?t("input",{directives:[{name:"model",rawName:"v-model",value:e.currentValue,expression:"currentValue"}],staticClass:"material-input",attrs:{name:e.name,placeholder:e.fillPlaceHolder,readonly:e.readonly,disabled:e.disabled,autocomplete:e.autoComplete,minlength:e.minlength,maxlength:e.maxlength,required:e.required,type:"text"},domProps:{value:e.currentValue},on:{focus:e.handleMdFocus,blur:e.handleMdBlur,input:[function(t){t.target.composing||(e.currentValue=t.target.value)},e.handleModelInput]}}):e._e(),t("span",{staticClass:"material-input-bar"}),t("label",{staticClass:"material-label"},[e._t("default")],2)])])},n=[],s={name:"MdInput",props:{icon:String,name:String,type:{type:String,default:"text"},value:[String,Number],placeholder:String,readonly:Boolean,disabled:Boolean,min:String,max:String,step:String,minlength:Number,maxlength:Number,required:{type:Boolean,default:!0},autoComplete:{type:String,default:"off"},validateEvent:{type:Boolean,default:!0}},data(){return{currentValue:this.value,focus:!1,fillPlaceHolder:null}},computed:{computedClasses(){return{"material--active":this.focus,"material--disabled":this.disabled,"material--raised":Boolean(this.focus||this.currentValue)}}},watch:{value(e){this.currentValue=e}},methods:{handleModelInput(e){const t=e.target.value;this.$emit("input",t),"ElFormItem"===this.$parent.$options.componentName&&this.validateEvent&&this.$parent.$emit("el.form.change",[t]),this.$emit("change",t)},handleMdFocus(e){this.focus=!0,this.$emit("focus",e),this.placeholder&&""!==this.placeholder&&(this.fillPlaceHolder=this.placeholder)},handleMdBlur(e){this.focus=!1,this.$emit("blur",e),this.fillPlaceHolder=null,"ElFormItem"===this.$parent.$options.componentName&&this.validateEvent&&this.$parent.$emit("el.form.blur",[this.currentValue])}}},i=s,u=(a("de87"),a("2877")),c=Object(u["a"])(i,o,n,!1,null,"9d7baaf6",null),m=c.exports,d=a("2f62"),p=a("5f87"),h=a("db49"),f=a("1925"),g=a("91b6"),v=a("2934"),b=a("1540"),y={name:"aPost",components:{MDinput:m},props:{isEdit:{type:Boolean,default:!1}},computed:{contentShortLength(){return null==this.postForm.summary?0:this.postForm.summary.length},...Object(d["b"])({user:function(){return this.$store.state.user}})},data(){const e=(e,t,a)=>{""===t?(this.$message({message:e.field+"为必传项",type:"error"}),a(new Error(e.field+"为必传项"))):a()};return{header:{Authentication:Object(p["b"])()},uploadAction:h["a"].API_URL+"/upload/uploadImage",postForm:{id:null,title:"",mid:null,movieList:[],uid:null!=this.user?this.user.id:null,username:null!=this.user?this.user.name:null,cover:"",content:"",summary:""},selectMovie:{value:""},loading:!1,dataObj:null,userListOptions:[],rules:{title:[{validator:e}],content:[{validator:e}]}}},created(){this.user.token?(this.postForm.uid=this.user.id,this.postForm.username=this.user.name):this.$router.push({name:"login",query:{redirect:this.$router.currentRoute.fullPath}}),Object(v["b"])().then(e=>{200===e.code?this.postForm.id=e.obj:location.reload()})},methods:{querySearchAsync(e,t){null!=e&&e.length>0&&Object(f["a"])(e).then(e=>{setTimeout(()=>{200===e.code?(this.movieList=e.obj,t(this.loadMovieList())):(this.$message.error(e.message),t())},600)})},getHtml(e){this.postForm.content=e},loadMovieList(){let e=new Array(0);for(let t=0;t<this.movieList.length;t++)e.push({id:this.movieList[t].id,value:this.movieList[t].name});return e},rmImage(){Object(g["a"])({imagePath:this.postForm.cover}).then(e=>{200===e.code?this.postForm.cover="":this.$message.error(e.message)})},handleSelect(e){this.selectMovie=e,this.postForm.mid=e.id},handleImageSuccess(e){200===e.code?this.postForm.cover=e.obj:this.$message.error(e.message)},submitForm(){this.$refs.postForm.validate(e=>{if(!e)return console.log("error submit!!"),!1;this.loading=!0,Object(b["g"])(this.postForm).then(e=>{200===e.code?(this.$message.success("文章发布成功！请等待管理员审核！"),this.returnLast()):this.$message.error(e.message)})})},returnLast(){this.$router.go(-1)}}},x=y,C=(a("bb20"),Object(u["a"])(x,r,l,!1,null,null,null));t["default"]=C.exports},"74cf":function(e,t,a){},"99ea":function(e,t,a){},bb20:function(e,t,a){"use strict";a("74cf")},de87:function(e,t,a){"use strict";a("99ea")}}]);
//# sourceMappingURL=chunk-78f70fc9.22ce56d2.js.map