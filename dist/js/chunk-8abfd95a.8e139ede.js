(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8abfd95a"],{"0224":function(t,e,i){"use strict";i("2b28")},1540:function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"a",(function(){return s})),i.d(e,"c",(function(){return o})),i.d(e,"d",(function(){return r})),i.d(e,"h",(function(){return c})),i.d(e,"f",(function(){return l})),i.d(e,"e",(function(){return u})),i.d(e,"g",(function(){return m}));var a=i("b775");function n(t){return Object(a["a"])({url:"/forum/articleList",method:"get",params:t})}function s(t){return Object(a["a"])({url:"/forum/detail/"+t,method:"get"})}function o(t,e){return Object(a["a"])({url:"/forum/userLike",method:"get",params:{eid:t,uid:e}})}function r(t,e,i){return Object(a["a"])({url:"/forum/likeArticle",method:"get",params:{aid:t,uid:e,authorId:i}})}function c(t){return Object(a["a"])({url:"/forum/comment",method:"post",data:t})}function l(t,e){return Object(a["a"])({url:"/forum/comments/"+t,method:"get",params:e})}function u(t){return Object(a["a"])({url:"/forum/likeComment",method:"get",params:t})}function m(t){return Object(a["a"])({url:"/forum/article",method:"post",data:t})}},"18da":function(t,e,i){"use strict";i("f5a0")},2397:function(t,e,i){"use strict";i("64e9")},"2b28":function(t,e,i){},"39d4":function(t,e,i){"use strict";i("7ecc")},"4c2d":function(t,e,i){"use strict";var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"score",style:{"background-position-y":`-${t.posY}px`}})},n=[],s={name:"rankstar",props:{score:{type:Number}},computed:{posY:function(){let t=0,e=this.score;return t=e>9?0:e>8?11:e>7?22:e>6?33:e>5?44:e>4?55:e>3?66:e>2?77:e>1?88:99,t}}},o=s,r=(i("86ab"),i("2877")),c=Object(r["a"])(o,a,n,!1,null,"009d837d",null);e["a"]=c.exports},"64e9":function(t,e,i){},"7ecc":function(t,e,i){},"86ab":function(t,e,i){"use strict";i("fb49")},"94a1":function(t,e,i){},a26f:function(t,e,i){"use strict";i("94a1")},aaa8:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t._self._c;return e("div",[t.articleInfo?e("div",{staticClass:"container-body",staticStyle:{width:"60%"}},[e("div",{staticClass:"detail-container",style:{width:this.global.bodyWidth-300+"px"}},[e("div",{staticClass:"article-detail"},[e("div",{staticClass:"title"},[0==t.articleInfo.status?e("span",{staticClass:"tag tag-no-audit"},[t._v("待审核")]):t._e(),t._v(" "+t._s(t.articleInfo.title)+" ")]),e("div",{staticClass:"user-info"},[e("div",{staticClass:"avatar"},[e("el-image",{staticClass:"avatar-img",attrs:{src:t.articleInfo.userImg}})],1),e("div",{staticClass:"user-info-detail"},[e("router-link",{staticClass:"nick-name a-link",attrs:{to:"/user/"+t.articleInfo.uid}},[t._v(t._s(t.articleInfo.username))]),e("div",{staticClass:"time-info"},[e("span",[t._v(t._s(t.articleInfo.createTime))]),e("span",{staticClass:"iconfont icon-eye-solid"},[t._v(" "+t._s(0==t.articleInfo.readCount?"阅读":t.articleInfo.readCount)+" ")]),t.articleInfo.uid==t.user.uid?e("router-link",{staticClass:"a-link btn-edit",attrs:{to:"/editPost/"+t.articleInfo.articleId}},[e("span",{staticClass:"iconfont icon-edit"},[t._v("编辑")])]):t._e()],1)],1)]),e("div",{staticClass:"detail",attrs:{id:"detail"},domProps:{innerHTML:t._s(t.articleInfo.content)}})]),t.articleInfo.mid?e("div",{staticClass:"attachment-panel",attrs:{id:"view-attachment"}},[e("div",{staticClass:"title"},[t._v("相关电影")]),e("div",{staticClass:"item-content"},[e("img",{staticClass:"item-img",attrs:{src:t.movieData.posterURL}}),e("div",{staticClass:"left-content"},[e("router-link",{staticClass:"title",attrs:{to:"/movie/"+t.movieData.id}},[e("div",[t._v(t._s(t.movieData.name))])]),e("div",{staticClass:"rank-content"},[e("rankstar",{staticClass:"rank-star",attrs:{score:null==t.movieData.score?0:2*t.movieData.score}}),e("div",{staticClass:"score-text"},[t._v(" "+t._s(null==t.movieData.score?0:t.movieData.score.toFixed(1))+" ")])],1),e("div",{staticClass:"place",staticStyle:{"margin-top":"5px"}},[t._v(" "+t._s(t.movieData.descri)+" ")])],1)])]):t._e(),1==t.articleInfo.status?e("div",{staticClass:"comment-panel",attrs:{id:"view-comment"}},[t.articleInfo.id?e("commentList",{attrs:{articleId:t.articleInfo.id,articleUserId:t.articleInfo.uid},on:{updateCommentCount:t.updateCommentCount}}):t._e()],1):t._e()])]):t._e(),e("div",{staticClass:"quick-panel",staticStyle:{left:"10%"}},[e("el-badge",{attrs:{value:t.articleInfo.likeCount,type:"info",hidden:!t.articleInfo.likeCount>0}},[e("div",{staticClass:"quick-item",on:{click:t.doLikeHandler}},[e("span",{class:["iconfont icon-good",t.hasLike?"have-like":""]})])]),e("el-badge",{attrs:{value:t.articleInfo.commentCount,type:"info",hidden:!t.articleInfo.commentCount>0}},[e("div",{staticClass:"quick-item",on:{click:function(e){return t.goToPostion("view-comment")}}},[e("span",{staticClass:"iconfont icon-comment"})])])],1),e("imageViewer",{ref:"imageViewerRef",attrs:{imageList:t.previewImgList}})],1)},n=[],s=i("4c2d"),o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"comment-body"},[e("div",{staticClass:"comment-title"},[e("div",{staticClass:"title"},[t._v(" 评论"),e("span",{staticClass:"count"},[t._v(t._s(t.count))])]),e("div",{staticClass:"tab"},[e("span",{class:["tab-item",0==t.orderType?"active":""],on:{click:function(e){return t.orderChange(0)}}},[t._v("热榜")]),e("el-divider",{attrs:{direction:"vertical"}}),e("span",{class:["tab-item",1==t.orderType?"active":""],on:{click:function(e){return t.orderChange(1)}}},[t._v("最新")])],1)]),e("div",{staticClass:"comment-form-panel"},[e("commentPost",{attrs:{articleId:t.articleId,pCommentId:"0",userId:t.user.id},on:{postCommentFinish:t.postCommentFinish}})],1),e("div",{staticClass:"comment-list"},[e("commentItemList",{attrs:{data:t.commentList,queryInfo:t.queryInfo,count:t.count,articleUserId:t.articleUserId,articleId:t.articleId,loading:t.loading,currentUserInfo:t.user},on:{loadData:t.loadComment}})],1)])},r=[],c=i("2f62"),l=function(){var t=this,e=t._self._c;return e("div",{staticClass:"post-comment-panel"},[e("div",{staticClass:"avatar"},[t.user.id?e("el-image",{staticClass:"avatar-img",attrs:{src:t.user.avatar}}):t._e(),t.user.id?t._e():e("div",{staticClass:"no-login"},[t._v("未登录")])],1),e("div",{staticClass:"comment-form"},[e("el-form",{ref:"formDataRef",attrs:{model:t.formData,rules:t.rules}},[e("el-form-item",{attrs:{prop:"content"}},[e("el-input",{attrs:{clearable:"",placeholder:t.placeholderInfo,type:"textarea",maxlength:800,resize:"none","show-word-limit":""},model:{value:t.formData.content,callback:function(e){t.$set(t.formData,"content",e)},expression:"formData.content"}})],1)],1)],1),e("div",{staticClass:"send-btn",on:{click:t.postCommentDo}},[t._v("发表")])])},u=[],m=i("1540"),d={name:"commentPost",props:{articleId:{type:String},pCommentId:{type:String},replyUserId:{type:String},userId:{type:String},placeholderInfo:{type:String,default:"请文明发言"}},data(){const t=(t,e,i)=>{null==e?i(new Error(t.message)):i()};return{articleInfo:{userImg:"http://124.222.196.87:9000/movie/movie_photo/images/1/poster.jpg"},formData:{content:""},rules:{content:[{required:!0,message:"请输入评论内容",validator:t},{min:5,message:"评论至少5个字"}]}}},methods:{postCommentDo(){this.user.token?this.$refs.formDataRef.validate(async t=>{if(!t)return;let e={};e.articleId=this.articleId,e.pCommentId=this.pCommentId,e.replyUserId=this.replyUserId,e.content=this.formData.content,await Object(m["h"])(e).then(t=>{200===t.code?(this.$refs.formDataRef.resetFields(),this.$emit("postCommentFinish",t.obj)):this.$message.error(t.message)})}):this.$router.push({name:"login",query:{redirect:this.$router.currentRoute.fullPath}})}},computed:{...Object(c["b"])({user:function(){return this.$store.state.user}})}},f=d,h=(i("39d4"),i("2877")),p=Object(h["a"])(f,l,u,!1,null,null,null),v=p.exports,g=function(){var t=this,e=t._self._c;return e("div",[t.loading||null==t.data||0!=t.data.length?t._e():e("div",[t._m(0)]),t.loading?e("div",{staticClass:"skeleton"},[e("el-skeleton",{attrs:{row:2,animated:""}})],1):t._e(),t._l(t.data,(function(i,a){return e("div",{key:a},[e("commentItem",{ref:"item",refInFor:!0,attrs:{articleId:t.articleId,commentData:i,articleUserId:t.articleUserId,currentUserId:t.currentUserInfo.userId},on:{hiddenAllReply:t.hiddenAllReplyHandler}})],1)})),e("div",{staticClass:"pagination"},[e("el-pagination",{staticStyle:{"text-align":"left"},attrs:{"hide-on-single-page":!0,background:"",total:t.count,"current-page":t.queryInfo.curPage,layout:"prev, pager, next","page-size":t.queryInfo.pageSize},on:{"update:currentPage":function(e){return t.$set(t.queryInfo,"curPage",e)},"update:current-page":function(e){return t.$set(t.queryInfo,"curPage",e)},"current-change":t.handlePageNoChange}})],1)],2)},C=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"no-data"},[e("div",{staticClass:"iconfont icon-empty"}),e("div",{staticClass:"msg"},[t._v("暂无评论")])])}],I=function(){var t=this,e=t._self._c;return e("div",{staticClass:"comment-item"},[e("div",{staticClass:"avatar"},[e("el-image",{staticClass:"avatar-img",attrs:{src:t.commentData.userImg}})],1),e("div",{staticClass:"comment-info"},[e("div",{staticClass:"nick-name"},[e("span",{staticClass:"name"},[t._v(t._s(t.commentData.username))]),t.commentData.uid==t.articleUserId?e("span",{staticClass:"tag-author"},[t._v("作者")]):t._e()]),e("div",{staticClass:"comment-content"},[e("div",[e("span",{domProps:{innerHTML:t._s(t.commentData.content)}})])]),e("div",{staticClass:"op-panel"},[e("div",{staticClass:"time"},[e("span",[t._v(t._s(t.commentData.createTime?t.dateFormat(t.commentData.createTime):""))])]),e("div",{class:["iconfont icon-good",1==t.commentData.isLike?"active":""],on:{click:function(e){return t.doLike(t.commentData)}}},[t._v(" "+t._s(t.commentData.likeCount>0?t.commentData.likeCount:"点赞")+" ")]),e("div",{staticClass:"iconfont icon-comment",on:{click:function(e){return t.showReplyPanel(t.commentData,0)}}},[t._v(" 回复 ")])]),t.commentData.children?e("div",{staticClass:"comment-sub-list"},t._l(t.commentData.children,(function(i,a){return e("div",{key:a,staticClass:"comment-sub-item"},[e("div",{staticClass:"avatar"},[e("el-image",{staticClass:"avatar-img",attrs:{src:i.userImg}})],1),e("div",{staticClass:"comment-sub-info"},[e("div",{staticClass:"nick-name"},[e("span",{staticClass:"name"},[t._v(t._s(i.username))]),i.uid===t.articleUserId?e("span",{staticClass:"tag-author"},[t._v("作者")]):t._e(),e("span",{staticClass:"reply-name"},[t._v("回复")]),e("span",{staticClass:"a-link"},[t._v("@"+t._s(i.replyUsername))]),e("span",[t._v("：")]),e("span",{staticClass:"sub-content",domProps:{innerHTML:t._s(i.content)}})]),e("div",{staticClass:"op-panel"},[e("div",{staticClass:"time"},[e("span",[t._v(t._s(i.createTime))])]),e("div",{class:["iconfont icon-good",1==i.isLike?"active":""],on:{click:function(e){return t.doLike(i)}}},[t._v(" "+t._s(i.likeCount>0?i.likeCount:"点赞")+" ")]),e("div",{staticClass:"iconfont icon-comment",on:{click:function(e){return t.showReplyPanel(i,1)}}},[t._v(" 回复 ")])])])])})),0):t._e(),e("div",{directives:[{name:"show",rawName:"v-show",value:t.commentData.showReply,expression:"commentData.showReply"}],staticClass:"reply-info"},[e("commentPost",{attrs:{placeholderInfo:t.placeholderInfo,articleId:t.articleId,pCommentId:t.pCommentId+"",replyUserId:t.replyUserId,userId:t.currentUserId},on:{postCommentFinish:t.postCommentFinish}})],1)])])},b=[],y={name:"commentItem",components:{commentPost:v},props:{articleId:{type:String},commentData:{type:Object},articleUserId:{type:String},currentUserId:{type:String}},data(){return{pCommentId:0,replyUserId:null,placeholderInfo:null,self:this}},computed:{...Object(c["b"])({user:function(){return this.$store.state.user}})},methods:{showReplyPanel(t,e){if(!this.user.token)return void this.$router.push({name:"login",query:{redirect:this.$router.currentRoute.fullPath}});this.pCommentId=this.commentData.id,this.replyUserId=t.uid,this.placeholderInfo="回复 @"+t.username;const i=void 0!=this.commentData.showReply&&this.commentData.showReply;this.$emit("hiddenAllReply"),this.commentData.showReply=0!=e||!i,this.self.$forceUpdate()},postCommentFinish(t){this.commentData.children=t,this.placeholderInfo=void 0},doLike(t){this.user.token?Object(m["e"])({cid:t.id}).then(e=>{200===e.code?(t.likeCount=e.obj.likeCount,t.isLike=e.obj.isLike):this.$message.error(e.message)}):this.$router.push({name:"login",query:{redirect:this.$router.currentRoute.fullPath}})},dateFormat(t){var e=new Date(t),i=e.getFullYear(),a=e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,n=e.getDate()<10?"0"+e.getDate():e.getDate(),s=e.getHours()<10?"0"+e.getHours():e.getHours(),o=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes(),r=e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds();return i+"-"+a+"-"+n+" "+s+":"+o+":"+r},update(){this.self.$forceUpdate()}}},_=y,k=(i("0224"),Object(h["a"])(_,I,b,!1,null,null,null)),j=k.exports,D={name:"commentItemList",components:{commentItem:j},props:{data:{type:Array},count:{type:Number},queryInfo:{type:Object},loading:{type:Boolean},currentUserInfo:{type:Object},articleUserId:{type:String},articleId:{type:String}},data(){return{}},created(){},methods:{handlePageNoChange(t){this.queryInfo.curPage=t,this.$emit("loadData")},hiddenAllReplyHandler(){this.data.forEach((t,e)=>{this.$refs.item[e].update(),t.showReply=!1})}}},w=D,O=(i("18da"),Object(h["a"])(w,g,C,!1,null,null,null)),$=O.exports,L={name:"commentList",components:{commentPost:v,commentItemList:$},props:{articleId:{type:String},articleUserId:{type:String}},data(){return{orderType:0,commentList:[],count:0,queryInfo:{curPage:1,pageSize:15,orderType:0},loading:!1}},methods:{orderChange(t){this.orderType=t,this.queryInfo.orderType=t,this.loadComment()},postCommentFinish(t){this.commentList.unshift(t),this.coount=Number(this.count)+1,this.$emit("updataCommentCount",this.count)},async loadComment(){this.loading=!0,await Object(m["f"])(this.articleId,this.queryInfo).then(t=>{200===t.code?(this.commentList=null==t.obj.objs?[]:t.obj.objs,this.count=t.obj.count):this.$message.error(t.message)}),this.loading=!1}},computed:{...Object(c["b"])({user:function(){return this.$store.state.user}})},created(){this.loadComment()}},P=L,U=(i("a26f"),Object(h["a"])(P,o,r,!1,null,"08d2c5f7",null)),R=U.exports,S=i("fc91"),q={name:"articleDetail",components:{rankstar:s["a"],commentList:R},data(){return{movieData:{},articleInfo:{},hasLike:!1,id:null,commentCount:0,imageViewerRef:null,previewImgList:[]}},watch:{"$route.params":{handler(t){this.id=t.id,this.getDetail(t.id)},immediate:!0}},methods:{doLikeHandler(){this.user.id?this.hasLike?this.$message.error("您已经点过赞了"):Object(m["d"])(this.id,this.user.id,this.articleInfo.uid).then(t=>{200===t.code?(this.articleInfo.likeCount=Number(this.articleInfo.likeCount)+1,this.hasLike=!0,this.$message.success("点赞成功")):this.$message.error(t.message)}):this.$router.push({name:"login",query:{redirect:this.$router.currentRoute.fullPath}})},goToPostion(t){document.querySelector("#"+t).scrollIntoView()},imagePreview(){this.$nextTick(()=>{const t=document.querySelector("#detail").querySelectorAll("img"),e=[];t.forEach((t,i)=>{const a=t.getAttribute("src");e.push(a),t.addEventListener("click",()=>{this.$refs.imageViewerRef.show(i)})}),this.previewImgList=e})},updateCommentCount(t){this.commentCount=t},async getDetail(t){await Object(m["a"])(t).then(t=>{200===t.code?(this.articleInfo=null==t.obj?{}:t.obj,this.imagePreview()):this.$message.error(t.message)}),null!==this.articleInfo&&void 0!==this.articleInfo&&(null!==this.articleInfo.mid&&void 0!==this.articleInfo.mid&&Object(S["a"])(this.articleInfo.mid).then(t=>{200===t.code?this.movieData=null==t.obj?{}:t.obj:this.$message.error(t.message)}),this.user.id&&Object(m["c"])(this.articleInfo.id,this.user.id).then(t=>{200===t.code&&(this.hasLike=null!=t.obj&&t.obj)}))}},computed:{...Object(c["b"])({user:function(){return this.$store.state.user}})}},x=q,T=(i("2397"),Object(h["a"])(x,a,n,!1,null,null,null));e["default"]=T.exports},f5a0:function(t,e,i){},fb49:function(t,e,i){},fc91:function(t,e,i){"use strict";i.d(e,"c",(function(){return n})),i.d(e,"e",(function(){return s})),i.d(e,"d",(function(){return o})),i.d(e,"h",(function(){return r})),i.d(e,"a",(function(){return c})),i.d(e,"b",(function(){return l})),i.d(e,"i",(function(){return u})),i.d(e,"g",(function(){return m})),i.d(e,"f",(function(){return d}));var a=i("b775");function n(t){return Object(a["a"])({url:"/movie/detail/"+t,method:"get"})}function s(t){return Object(a["a"])({url:"/movie/movies",method:"get",params:t})}function o(t){return Object(a["a"])({url:"/movieRecommend/movie/"+t,method:"get"})}function r(){return Object(a["a"])({url:"/home/getCarousels",method:"get"})}function c(t){return Object(a["a"])({url:"/movie/articleMovieInfo/"+t,method:"get"})}function l(t){return Object(a["a"])({url:"/movie/comments",method:"get",params:t})}function u(t){return Object(a["a"])({url:"/movie/comment",method:"post",data:t})}function m(t){return Object(a["a"])({url:"/movie/videos/"+t,method:"get"})}function d(t){return Object(a["a"])({url:"/home/sysReco",method:"get",params:t})}}}]);
//# sourceMappingURL=chunk-8abfd95a.8e139ede.js.map